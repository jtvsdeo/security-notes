# Setting up to pivot

### Knowledge of SOCKS and Proxychains

**Creating a SOCKS proxy through SSH tunnel**

`ssh -D 8123 user@<ip>`

`-D 8123` Opens a Socks proxy on local port 8123

**This is what we have so far**  
![](../../Assets/Pasted%20image%2020220801214810.png)


**Proxychains**
If we add a line to our proxychain config...
`socks4 127.0.0.1 8123`
Now proxychain is setup to use socks4 on the port 8123

**This is how it is forwarded now**  
![](../../Assets/Pasted%20image%2020220801215104.png)



### Scenario: Proxychaining inside a network.


![](../../Assets/Pasted%20image%2020220731231013.png)


We use ifconfig on the ubuntu server and realize it has multiple NIC's connecting to different networks.

We cannot access the internal network through attacker machine since we do not have routes or access to the other subnets 

### SSH Tunneling over SOCKS Proxy
We can perform dynamic port forwarding and pivot our network packets via the ubuntu server
Start a SOCKS listener on our local host and then configure SSH to forward the traffic via SSH to the internal network after connecting to the target host


**Enabling Dynamic Port forwarding with SSH**
`ssh -D 9050 ubuntu@10.129.202.64` 

`-D` enables dynamic port fotwarding

`Proxychains` is a tool to route any tools packets over port 9050 
To inform proxychains that we must use port 9050,  modify the proxychains config file `/etc/proxychain.conf` and add `socks4 127.0.0.1 9050`


#### Using Nmap with Proxychains

`proxychains nmap -v -sn 172.16.5.1-200`

**Rules:**
1. We can only perform a full TCP connect scan -> Proxychains cannot understand partial packets
2. Host alive may not work against windows targets because Windows Defender Firewall blocks ICMP by default
3.  Full TCP connect scan without ping takes time. Scan individual hosts or smaller range which we know are alive. 


### Using metasploit, xfreeRDP with proxychains
> We found a host with rdp open, we can perform vulnerable RDP scans using msf aux modules

`proxychains msfconsole`

In msf: `search rdp scanner`

`proxychains xfreerdp /v:<vulnerable host> /u:<user> /p:<pass>`

This way we can successsfully pivot to the host machines.
